# LLM Data Generator - Универсальный генератор JSON данных

## Статус проекта
✅ **Реализовано** - Проект полностью реализован и готов к использованию

## Обзор проекта
Универсальный инструмент для генерации JSON данных любой структуры с использованием LLM. Конфигурация включает JSON Schema для описания структуры и промпты для каждого поля.

## Структура проекта
```
llm-data-gen/
├── index.js                 # Точка входа CLI
├── lib/
│   ├── generator.js         # Основной класс генератора
│   ├── schemaParser.js      # Парсер JSON Schema в промпты
│   ├── promptBuilder.js     # Конструктор промптов из схемы
│   ├── validator.js         # Валидация по JSON Schema
│   ├── configManager.js     # Управление конфигурациями
│   └── apiClient.js         # Клиент для OpenRouter API
├── configs/
│   ├── default.json        # Конфигурация по умолчанию
│   └── examples/           # Примеры конфигураций
│       ├── quiz.json       # Для викторин (из текущего проекта)
│       ├── products.json   # Для товаров
│       └── articles.json   # Для статей
└── README.md
```

## Формат конфигурации

### Пример конфигурации для викторины (examples/quiz.json):
```json
{
  "meta": {
    "name": "Quiz Questions Generator",
    "version": "1.0",
    "description": "Генератор вопросов для викторины QuizChat"
  },
  "api": {
    "provider": "openrouter",
    "model": "openrouter/auto",
    "temperature": 0.6,
    "max_tokens": 4000
  },
  "output": {
    "type": "array",
    "itemsPerBatch": 1,
    "mergeStrategy": "append",
    "outputPath": "./data/quizzes/",
    "fileNameTemplate": "{theme_translit}.json"
  },
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
      "questions": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "x-llm-generate": {
                "template": "{theme_translit}_{index}",
                "description": "Уникальный идентификатор вопроса"
              }
            },
            "text": {
              "type": "string",
              "x-llm-generate": {
                "prompt": "Создай детальный вопрос на тему '{theme}' (минимум 10-15 слов)",
                "minLength": 50,
                "maxLength": 300,
                "requirements": [
                  "Вопрос должен быть полным и детальным",
                  "НЕ содержать ответ или подсказку",
                  "Тексты на русском, но названия оставлять на английском"
                ]
              }
            },
            "options": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "x-llm-generate": {
                "prompt": "Создай {answers} правдоподобных вариантов ответа",
                "count": "{answers}",
                "requirements": [
                  "Все варианты должны выглядеть реалистично",
                  "Неправильные ответы должны быть похожими на правильный"
                ]
              }
            },
            "correct": {
              "type": "integer",
              "x-llm-generate": {
                "description": "Индекс правильного ответа (0-based)",
                "range": [0, "{answers_minus_1}"]
              }
            },
            "category": {
              "type": "string",
              "x-llm-generate": {
                "value": "{theme}"
              }
            },
            "difficulty": {
              "type": "integer",
              "enum": [1, 2, 3],
              "x-llm-generate": {
                "mapping": {
                  "easy": 1,
                  "medium": 2,
                  "hard": 3
                },
                "value": "{difficulty_num}"
              }
            },
            "tags": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "x-llm-generate": {
                "prompt": "Добавь 1-3 конкретных тега, связанных с вопросом",
                "minItems": 1,
                "maxItems": 3
              }
            }
          },
          "required": ["id", "text", "options", "correct", "category", "difficulty", "tags"]
        }
      }
    }
  },
  "prompts": {
    "system": "Ты эксперт по созданию вопросов для викторин. Твои вопросы должны быть детальными, интересными и никогда не содержать ответ в самом вопросе. Названия игр, фильмов, сериалов и другие собственные названия оставляй на английском. Всегда возвращай только валидный JSON без дополнительного текста. Все варианты ответов должны выглядеть правдоподобно.",
    "examples": {
      "good": [
        "В каком году состоялась премьера первого сезона аниме-сериала Naruto, рассказывающего о приключениях юного ниндзя из деревни Коноха?",
        "Какой химический элемент в периодической таблице Менделеева имеет атомный номер 79 и часто используется в ювелирных изделиях?"
      ],
      "bad": [
        "Столица Франции? (слишком короткий)",
        "В каком аниме главный герой получает способность Death Note? (содержит ответ)"
      ]
    }
  },
  "generation": {
    "tasks": [
      {"theme": "Аниме", "count": 30, "difficulty": "easy", "answers": 3},
      {"theme": "Аниме", "count": 40, "difficulty": "easy", "answers": 4},
      {"theme": "Аниме", "count": 20, "difficulty": "medium", "answers": 3},
      {"theme": "История", "count": 20, "difficulty": "easy", "answers": 2},
      {"theme": "PC игры", "count": 40, "difficulty": "medium", "answers": 4}
    ]
  }
}
```

## Ключевые особенности

### 1. Расширенная JSON Schema (x-llm-generate)
- Каждое поле может иметь `x-llm-generate` с параметрами генерации
- Поддержка шаблонов с плейсхолдерами (`{theme}`, `{index}`)
- Встроенные промпты для сложных полей
- Маппинг значений (easy → 1)

### 2. CLI интерфейс
```bash
# Использование конфига по умолчанию
llm-data-gen

# Указать конфиг
llm-data-gen --config quiz.json

# Переопределить параметры
llm-data-gen --model "openai/gpt-4" --count 50

# Только валидация существующих данных
llm-data-gen validate data.json --schema quiz.json
```

### 3. Поддержка вложенных структур
```json
{
  "product": {
    "name": "...",
    "specs": {
      "dimensions": {
        "width": "...",
        "height": "..."
      }
    }
  }
}
```

### 4. Батч-генерация с прогрессом
- Генерация по одному элементу с отображением прогресса
- Автоматическое сохранение после каждого батча
- Возможность продолжить с места остановки

## Реализованные возможности

### ✅ Базовая функциональность
- Структура проекта с модульной архитектурой
- Парсер JSON Schema с поддержкой x-llm-generate аннотаций
- Генератор с поддержкой всех типов данных
- CLI интерфейс с полным набором команд

### ✅ Расширенные возможности
- Поддержка вложенных объектов и массивов
- Мощная система шаблонов и плейсхолдеров
- Валидация по JSON Schema (AJV)
- Батч-генерация с прогрессом
- Автоматические retry при ошибках API
- Кастомизация через CLI параметры

### ✅ Дополнительно реализовано
- Тестирование соединения с API
- Листинг и загрузка примеров конфигураций
- Создание шаблонов конфигураций
- Валидация существующих данных
- Поддержка переменных окружения (.env)
- Красивый вывод с прогресс-барами (ora, chalk)

## Примеры использования

### 1. Генерация вопросов для викторины (из текущего проекта):
```bash
# Генерация вопросов по аниме
llm-data-gen --config examples/quiz.json

# Результат будет сохранен в data/quizzes/anime.json
```

### 2. Генерация товаров для e-commerce:
```json
{
  "schema": {
    "items": {
      "properties": {
        "name": { "x-llm-generate": { "prompt": "Название товара в категории {category}" }},
        "price": { "x-llm-generate": { "range": [100, 5000] }},
        "description": { "x-llm-generate": { "prompt": "Описание товара, 2-3 предложения" }}
      }
    }
  }
}
```

### 3. Генерация статей блога:
```json
{
  "schema": {
    "items": {
      "properties": {
        "title": { "x-llm-generate": { "prompt": "Заголовок статьи о {topic}" }},
        "summary": { "x-llm-generate": { "maxLength": 200 }},
        "tags": { "x-llm-generate": { "count": 5 }}
      }
    }
  }
}
```

### 4. Генерация тестовых пользователей:
```json
{
  "schema": {
    "items": {
      "properties": {
        "name": { "x-llm-generate": { "prompt": "Полное имя на русском языке" }},
        "email": { "x-llm-generate": { "template": "{firstName}.{lastName}@example.com" }},
        "age": { "x-llm-generate": { "range": [18, 65] }}
      }
    }
  }
}
```

## Преимущества подхода
1. **Универсальность** - работает с любыми JSON структурами
2. **Декларативность** - схема описывает что генерировать
3. **Расширяемость** - легко добавлять новые типы и валидаторы
4. **Переиспользование** - конфиги можно шарить и версионировать
5. **Типобезопасность** - валидация по JSON Schema

## Технические детали реализации

### Архитектура модулей:
- **apiClient.js** - Клиент для OpenRouter API с retry логикой
- **schemaParser.js** - Парсер JSON Schema, извлекает пути и x-llm-generate аннотации
- **promptBuilder.js** - Построение промптов из схемы и шаблонов
- **validator.js** - Валидация данных через AJV
- **configManager.js** - Управление конфигурациями (загрузка, слияние, валидация)
- **generator.js** - Основная логика генерации с батчингом

### Алгоритм генерации:
1. Загрузка и валидация конфигурации
2. Парсинг JSON Schema и извлечение полей с x-llm-generate
3. Для каждой задачи из generation.tasks:
   - Построение контекста с плейсхолдерами
   - Генерация промптов для каждого поля
   - Вызов LLM API с системным промптом
   - Обработка ответа и подстановка шаблонов
   - Валидация по схеме
   - Сохранение результатов
4. Вывод итоговой статистики

### Обработка ошибок:
- 3 попытки retry с экспоненциальной задержкой
- Детальные сообщения об ошибках API
- Валидация каждого сгенерированного объекта
- Продолжение генерации при ошибках отдельных элементов

### Особенности реализации:
- ES6 модули (type: "module")
- Async/await для всех асинхронных операций
- Транслитерация для имен файлов
- Поддержка переменных окружения через dotenv
- Прогресс-бары через ora
- Цветной вывод через chalk