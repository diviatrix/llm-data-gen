<div class="stack">
  
  <div class="mb-m">
    <h2 class="text-2xl font-semibold" x-text="$store.i18n.t('settings.settings')"></h2>
    <p class="text-gray-600 mt-s" x-text="$store.i18n.t('settings.manageSettings')"></p>
  </div>
  
  
  <div class="card">
    <div class="card-header">
      <h3 class="text-lg font-semibold">
        <span x-text="$store.i18n.t('settings.personalApiKey')"></span>
      </h3>
    </div>
    <div class="card-body">
      
      <div x-show="isLoading" class="flex justify-center py-m">
        <div class="spinner"></div>
      </div>
      
      
      <div x-show="!isLoading">
        
        <div x-show="hasApiKey">
          <div class="alert alert-success mb-m">
            <p>✓ <span x-text="$store.i18n.t('settings.apiKeyConfigured')"></span></p>
          </div>
          
          <p class="meta-text mb-m">
            <span x-text="$store.i18n.t('settings.apiKeySecurelyStored')"></span>
          </p>
          
          <div class="flex gap-s">
            <button @click="showApiKey = true" 
                    x-show="!showApiKey"
                    class="btn btn-secondary btn-sm">
              <span x-text="$store.i18n.t('buttons.updateApiKey')"></span>
            </button>
            <button @click="deleteApiKey()" 
                    :disabled="isDeleting"
                    class="btn btn-danger btn-sm">
              <span x-show="!isDeleting" x-text="$store.i18n.t('buttons.deleteApiKey')"></span>
              <span x-show="isDeleting" x-text="$store.i18n.t('settings.deleting')"></span>
            </button>
          </div>
        </div>
        
        
        <div x-show="!hasApiKey || showApiKey">
          <div x-show="!hasApiKey" class="alert alert-warning mb-m">
            <p>⚠️ <span x-text="$store.i18n.t('messages.warnings.noApiKeyConfigured')"></span></p>
          </div>
          
          <p class="meta-text mb-m">
            <span x-text="$store.i18n.t('settings.getApiKeyFrom')"></span> <a href="https://openrouter.ai/keys" target="_blank" class="text-primary hover:underline">openrouter.ai/keys</a>
          </p>
          
          <div class="space-y-m">
            <div>
              <label class="form-label" x-text="$store.i18n.t('forms.apiKey')"></label>
              <input type="password" 
                     x-model="apiKey" 
                     @keyup.enter="saveApiKey()"
                     :placeholder="$store.i18n.t('placeholders.apiKey')" 
                     class="form-input">
              <p class="text-xs text-gray-500 mt-s" x-text="$store.i18n.t('settings.apiKeyWillBeStored')"></p>
            </div>
            
            <div class="flex gap-s">
              <button @click="saveApiKey()" 
                      :disabled="!apiKey || isSaving"
                      class="btn btn-primary">
                <span x-show="!isSaving" x-text="$store.i18n.t('buttons.saveApiKey')"></span>
                <span x-show="isSaving" x-text="$store.i18n.t('settings.saving')"></span>
              </button>
              <button @click="showApiKey = false; apiKey = ''" 
                      x-show="hasApiKey && showApiKey"
                      class="btn btn-ghost">
                <span x-text="$store.i18n.t('buttons.cancel')"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  <div class="card">
    <div class="card-header">
      <h3 class="text-lg font-semibold">
        <span x-text="$store.i18n.t('settings.accountPreferences')"></span>
      </h3>
    </div>
    <div class="card-body">
      <div class="space-y-m">
        <div>
          <label class="flex items-center gap-s cursor-pointer">
            <input type="checkbox" 
                   x-model="onlyFreeModels" 
                   @change="updateFreeModelsPreference()"
                   class="form-checkbox">
            <div>
              <span x-text="$store.i18n.t('settings.onlyFreeModels')"></span>
              <p class="text-xs text-gray-600 mt-1">
                <span x-text="$store.i18n.t('settings.onlyFreeModelsDesc')"></span>
              </p>
            </div>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  
  <div class="card" x-show="$root.isAdmin">
    <div class="card-header">
      <h3 class="text-lg font-semibold"><span x-text="$store.i18n.t('settings.systemApiKey')"></span> <span class="text-sm font-normal text-gray-600" x-text="$store.i18n.t('settings.adminOnly')"></span></h3>
    </div>
    <div class="card-body">
      <div x-show="!isLoadingSystemKey">
        
        <div x-show="hasSystemApiKey">
          <div class="alert alert-success mb-m">
            <p>✓ <span x-text="$store.i18n.t('settings.systemApiKeyConfigured')"></span></p>
          </div>
          
          <p class="meta-text mb-m">
            <span x-text="$store.i18n.t('settings.systemApiKeyDescription')"></span>
          </p>
          
          <div class="flex gap-s">
            <button @click="showSystemApiKey = true" 
                    x-show="!showSystemApiKey"
                    class="btn btn-secondary btn-sm">
              <span x-text="$store.i18n.t('buttons.updateApiKey')"></span>
            </button>
            <button @click="deleteSystemApiKey()" 
                    :disabled="isDeletingSystemKey"
                    class="btn btn-danger btn-sm">
              <span x-show="!isDeletingSystemKey" x-text="$store.i18n.t('buttons.deleteApiKey')"></span>
              <span x-show="isDeletingSystemKey" x-text="$store.i18n.t('settings.deleting')"></span>
            </button>
          </div>
        </div>
        
        
        <div x-show="!hasSystemApiKey || showSystemApiKey">
          <div x-show="!hasSystemApiKey" class="alert alert-warning mb-m">
            <p>⚠️ <span x-text="$store.i18n.t('messages.warnings.noSystemApiKeyConfigured')"></span></p>
          </div>
          
          <p class="meta-text mb-m">
            <span x-text="$store.i18n.t('settings.configureSystemApiKey')"></span>
          </p>
          
          <div class="space-y-m">
            <div>
              <label class="form-label" x-text="$store.i18n.t('forms.systemApiKey')"></label>
              <input type="password" 
                     x-model="systemApiKey" 
                     @keyup.enter="saveSystemApiKey()"
                     :placeholder="$store.i18n.t('placeholders.apiKey')" 
                     class="form-input">
              <p class="text-xs text-gray-500 mt-s" x-text="$store.i18n.t('settings.systemKeyForOperations')"></p>
            </div>
            
            <div class="flex gap-s">
              <button @click="saveSystemApiKey()" 
                      :disabled="!systemApiKey || isSavingSystemKey"
                      class="btn btn-primary">
                <span x-show="!isSavingSystemKey" x-text="$store.i18n.t('buttons.saveApiKey')"></span>
                <span x-show="isSavingSystemKey" x-text="$store.i18n.t('settings.saving')"></span>
              </button>
              <button @click="showSystemApiKey = false; systemApiKey = ''" 
                      x-show="hasSystemApiKey && showSystemApiKey"
                      class="btn btn-ghost">
                <span x-text="$store.i18n.t('buttons.cancel')"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  
  <div class="card" x-show="$root.user">
    <div class="card-header">
      <h3 class="text-lg font-semibold" x-text="$store.i18n.t('settings.accountInformation')"></h3>
    </div>
    <div class="card-body">
      <div class="space-y-s">
        <div>
          <span class="meta-text" x-text="$store.i18n.t('forms.email') + ':'"></span>
          <span class="ml-s font-medium" x-text="$root.user?.email"></span>
        </div>
        <div x-show="storageInfo">
          <span class="meta-text" x-text="$store.i18n.t('admin.storage') + ':'"></span>
          <span class="ml-s font-medium">
            <span x-text="formatBytes(storageInfo?.used || 0)"></span> / 
            <span x-text="formatBytes(storageInfo?.quota || 0)"></span>
            <span class="text-xs text-gray-500">
              (<span x-text="Math.round((storageInfo?.used || 0) / (storageInfo?.quota || 1) * 100)"></span>% used)
            </span>
          </span>
        </div>
        <div x-show="$root.accountInfo">
          <span class="meta-text" x-text="$store.i18n.t('settings.openRouterUsage') + ':'"></span>
          <span class="ml-s font-medium">
            $<span x-text="$root.accountInfo?.usage"></span> / $<span x-text="$root.accountInfo?.limit"></span>
          </span>
        </div>
      </div>
    </div>
  </div>

  
  <div class="card">
    <div class="card-header">
      <h3 class="text-lg font-semibold" x-text="$store.i18n.t('settings.changePassword')"></h3>
    </div>
    <div class="card-body">
      <div x-show="!showPasswordForm">
        <p class="meta-text mb-m">
          <span x-text="$store.i18n.t('settings.updateAccountPassword')"></span>
        </p>
        <button @click="showPasswordForm = true" class="btn btn-secondary">
          <span x-text="$store.i18n.t('buttons.changePassword')"></span>
        </button>
      </div>
      
      <div x-show="showPasswordForm" class="space-y-m">
        <div>
          <label class="form-label" x-text="$store.i18n.t('forms.currentPassword')"></label>
          <input type="password" 
                 x-model="currentPassword" 
                 @keyup.enter="focusNewPassword()"
                 :placeholder="$store.i18n.t('placeholders.currentPassword')" 
                 class="form-input">
        </div>
        
        <div>
          <label class="form-label" x-text="$store.i18n.t('forms.newPassword')"></label>
          <input type="password" 
                 x-model="newPassword"
                 x-ref="newPasswordInput"
                 @keyup.enter="focusConfirmPassword()"
                 :placeholder="$store.i18n.t('placeholders.newPassword')" 
                 class="form-input">
          <p class="text-xs text-gray-500 mt-s" x-show="newPassword && newPassword.length < 4">
            <span x-text="$store.i18n.t('messages.warnings.passwordTooShort')"></span>
          </p>
        </div>
        
        <div>
          <label class="form-label" x-text="$store.i18n.t('forms.confirmPassword')"></label>
          <input type="password" 
                 x-model="confirmPassword"
                 x-ref="confirmPasswordInput"
                 @keyup.enter="changePassword()"
                 :placeholder="$store.i18n.t('placeholders.confirmPassword')" 
                 class="form-input">
          <p class="text-xs text-red-500 mt-s" x-show="confirmPassword && newPassword !== confirmPassword">
            <span x-text="$store.i18n.t('messages.warnings.passwordsDoNotMatch')"></span>
          </p>
        </div>
        
        <div class="flex gap-s">
          <button @click="changePassword()" 
                  :disabled="!canChangePassword() || isChangingPassword"
                  class="btn btn-primary">
            <span x-show="!isChangingPassword" x-text="$store.i18n.t('buttons.changePassword')"></span>
            <span x-show="isChangingPassword" x-text="$store.i18n.t('settings.changing')"></span>
          </button>
          <button @click="cancelPasswordChange()" 
                  :disabled="isChangingPassword"
                  class="btn btn-ghost">
            <span x-text="$store.i18n.t('buttons.cancel')"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>