<div class="stack">
  <!-- Header -->
  <div class="mb-m">
    <h2 class="text-2xl font-semibold">Data Generator</h2>
    <p class="text-gray-600 mt-s">Generate structured data using AI models</p>
  </div>
  
  <!-- Progress Indicator -->
  <div class="action-row mb-l">
    <template x-for="(label, index) in ['Select Config', 'Select Model', 'Confirm', 'Generate']" :key="index">
      <div class="flex items-center">
        <div class="flex items-center">
          <div class="progress-indicator"
               :class="step > index + 1 ? 'progress-indicator-completed' : step === index + 1 ? 'progress-indicator-active' : 'progress-indicator-pending'"
               x-text="index + 1"></div>
          <span class="text-sm ml-s" 
                :class="step === index + 1 ? 'text-primary font-medium' : 'text-gray-500'"
                x-text="label"></span>
        </div>
        <div x-show="index < 3" class="progress-connector"
             :class="step > index + 1 ? 'progress-connector-completed' : ''"></div>
      </div>
    </template>
  </div>
  
  <!-- Step 1: Select Configuration -->
  <div x-show="step === 1" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Select Configuration</h3>
      
      <!-- Message when no config parameter -->
      <div x-show="!hasConfigParam" class="empty-state">
        <p class="text-gray-600 mb-m">Please select a configuration from the File Manager to generate data.</p>
        <a href="#/files" class="btn btn-primary">Go to File Manager</a>
      </div>
      
      <!-- Loading message if config parameter exists but still on step 1 -->
      <div x-show="hasConfigParam" class="empty-state">
        <p class="text-gray-600">Loading configuration...</p>
      </div>
    </div>
  </div>
  
  <!-- Step 2: Select Model -->
  <div x-show="step === 2" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Select AI Model</h3>
      
      <!-- Show config model if exists -->
      <div x-show="configModel" class="mb-m">
        <p class="meta-text mb-s">
          Configuration uses this model:
          <span x-show="configModel && configModel.endsWith(':online')" class="ml-1">üåê</span>
        </p>
        <template x-if="configModel && models.find(m => m.id === (configModel || '').replace(':online', ''))">
          <div class="card p-m" :class="selectedModel?.id === (configModel || '').replace(':online', '') ? 'border-primary' : ''">
            <div class="flex justify-between">
              <div class="flex-1">
                <div class="flex justify-between items-start mb-s">
                  <h4 class="font-medium text-sm ">
                    <span x-text="models.find(m => m.id === (configModel || '').replace(':online', ''))?.name"></span>
                    <span x-show="configModel && configModel.endsWith(':online')" class="ml-1">üåê</span>
                  </h4>
                  <span class="text-xs text-gray-500 ml-s" x-text="getProviderName(models.find(m => m.id === (configModel || '').replace(':online', '')))"></span>
                </div>
                
                <!-- Badges -->
                <div class="flex flex-wrap gap-s mb-s">
                  <template x-for="badge in getModelBadges(models.find(m => m.id === (configModel || '').replace(':online', '')))" :key="badge.label">
                    <span :class="badge.class" class="badge text-xs " x-text="badge.label"></span>
                  </template>
                </div>
                
                <!-- Compact Details -->
                <div class="text-xs text-gray-600">
                  <div class="flex items-center gap-s flex-wrap">
                    <div x-show="models.find(m => m.id === (configModel || '').replace(':online', ''))?.max_completion_tokens" class="flex items-center gap-s">
                      <span class="text-gray-500">Max:</span>
                      <span x-text="models.find(m => m.id === (configModel || '').replace(':online', ''))?.max_completion_tokens?.toLocaleString() + ' tokens'"></span>
                    </div>
                    <div x-show="models.find(m => m.id === (configModel || '').replace(':online', ''))?.input_modalities?.length > 0 || models.find(m => m.id === (configModel || '').replace(':online', ''))?.output_modalities?.length > 0" class="text-gray-500">
                      <span x-text="formatModalities(models.find(m => m.id === (configModel || '').replace(':online', ''))?.input_modalities, models.find(m => m.id === (configModel || '').replace(':online', ''))?.output_modalities)"></span>
                    </div>
                  </div>
                  <div class="flex justify-between mt-s">
                    <span class="text-gray-500">$<span x-text="((models.find(m => m.id === (configModel || '').replace(':online', ''))?.pricing?.prompt || 0) * 1000).toFixed(3)"></span>/1K in</span>
                    <span class="text-gray-500">$<span x-text="((models.find(m => m.id === (configModel || '').replace(':online', ''))?.pricing?.completion || 0) * 1000).toFixed(3)"></span>/1K out</span>
                  </div>
                  <div x-show="models.find(m => m.id === (configModel || '').replace(':online', ''))?.supports_web_search" class="mt-s">
                    <template x-if="getWebSearchPricing(models.find(m => m.id === (configModel || '').replace(':online', '')))">
                      <span class="text-xs text-primary">
                        <span x-text="getWebSearchPricing(models.find(m => m.id === (configModel || '').replace(':online', ''))).label"></span>: 
                        $<span x-text="getWebSearchPricing(models.find(m => m.id === (configModel || '').replace(':online', ''))).price.toFixed(2)"></span>/1K requests
                      </span>
                    </template>
                  </div>
                </div>
              </div>
              <div class="ml-3 flex flex-col gap-s">
                <button x-show="!selectedModel || selectedModel.id !== (configModel || '').replace(':online', '')" 
                        @click="selectedModel = models.find(m => m.id === (configModel || '').replace(':online', '')); if(selectedModel) nextStep()" 
                        class="btn btn-primary btn-sm">
                  Use this model
                </button>
                <button x-show="selectedModel && selectedModel.id === (configModel || '').replace(':online', '')" 
                        @click="nextStep()" 
                        class="btn btn-primary btn-sm">
                  Continue ‚Üí
                </button>
              </div>
            </div>
          </div>
        </template>
        <div class="mt-3 meta-text">Or select a different model below:</div>
      </div>
      
      <!-- Model Filters -->
      <div class="mb-m">
        <!-- Active filter count and clear button -->
        <div class="flex justify-between items-center mb-m">
          <h4 class="text-sm font-medium text-gray-700">
            Filters
            <span x-show="getActiveFilterCount() > 0" class="ml-s">
              (<span x-text="getActiveFilterCount()"></span> active)
            </span>
          </h4>
          <button x-show="getActiveFilterCount() > 0" 
                  @click="clearAllFilters()" 
                  class="btn btn-ghost btn-sm">
            Clear all
          </button>
        </div>
        
        <!-- Filter groups -->
        <div class="space-y-3">
          <template x-for="(group, groupKey) in filterGroups" :key="groupKey">
            <div x-show="config.showFilters">
              <div class="text-xs font-medium text-gray-600 mb-s" x-text="group.label"></div>
              <div class="flex flex-wrap gap-s">
                <template x-for="filter in group.filters" :key="filter.value">
                  <button @click="toggleFilter(groupKey, filter.value)"
                          :class="isFilterActive(groupKey, filter.value) ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    <span x-text="filter.icon"></span>
                    <span x-text="filter.label"></span>
                    <span class="opacity-60">(<span x-text="filter.count"></span>)</span>
                  </button>
                </template>
              </div>
            </div>
          </template>
        </div>
      </div>
      
      <!-- Model count -->
      <div class="flex justify-between items-center mb-m">
        <p class="meta-text">
          Showing <span x-text="filteredModels.length" class="font-medium"></span> 
          of <span x-text="models.length" class="font-medium"></span> models
        </p>
      </div>
      
      <!-- Model List -->
      <div class="grid-2 gap-m model-grid overflow-y-auto">
        <template x-for="model in filteredModels" :key="model.id">
          <div @click="selectModel(model)" 
               class="card-interactive p-m"
               :class="selectedModel?.id === model.id ? 'border-primary' : ''">
            <div class="flex justify-between items-start mb-s">
              <h4 class="font-medium text-sm " x-text="model.name"></h4>
              <span class="text-xs text-gray-500 ml-s" x-text="getProviderName(model)"></span>
            </div>
            
            <!-- Badges -->
            <div class="flex flex-wrap gap-s mb-s">
              <template x-for="badge in getModelBadges(model)" :key="badge.label">
                <span :class="badge.class" class="badge text-xs " x-text="badge.label"></span>
              </template>
            </div>
            
            <!-- Compact Details -->
            <div class="text-xs text-gray-600">
              <div class="flex items-center gap-s flex-wrap">
                <div x-show="model.max_completion_tokens" class="flex items-center gap-s">
                  <span class="text-gray-500">Max:</span>
                  <span x-text="model.max_completion_tokens?.toLocaleString() + ' tokens'"></span>
                </div>
                <div x-show="model.input_modalities?.length > 0 || model.output_modalities?.length > 0" class="text-gray-500">
                  <span x-text="formatModalities(model.input_modalities, model.output_modalities)"></span>
                </div>
              </div>
              <div class="flex justify-between mt-s">
                <span class="text-gray-500">$<span x-text="((model.pricing?.prompt || 0) * 1000).toFixed(3)"></span>/1K in</span>
                <span class="text-gray-500">$<span x-text="((model.pricing?.completion || 0) * 1000).toFixed(3)"></span>/1K out</span>
              </div>
              <div x-show="model.supports_web_search" class="mt-s">
                <template x-if="getWebSearchPricing(model)">
                  <span class="text-xs text-primary">
                    <span x-text="getWebSearchPricing(model).label"></span>: 
                    $<span x-text="getWebSearchPricing(model).price.toFixed(2)"></span>/1K requests
                  </span>
                </template>
              </div>
            </div>
          </div>
        </template>
      </div>
      
      <div class="flex justify-between mt-l">
        <button @click="prevStep()" class="btn btn-ghost">‚Üê Back</button>
        <div x-show="!configModel || selectedModel?.id !== configModel">
          <button @click="nextStep()" :disabled="!selectedModel" class="btn btn-primary">Next ‚Üí</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Step 3: Confirm -->
  <div x-show="step === 3" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Confirm Generation</h3>
      
      <div class="stack-m">
        <!-- Configuration Details -->
        <div class="card-sectioned">
          <div class="card-header">
            <h4 class="font-semibold">Configuration Details</h4>
          </div>
          <div class="card-body">
            <div class="grid-2 gap-m">
              <div>
                <div class="meta-text">Configuration File</div>
                <div class="font-medium" x-text="selectedConfig?.name"></div>
              </div>
              <div>
                <div class="meta-text">Output Format</div>
                <div class="font-medium" x-text="configContent?.output?.format || 'json'"></div>
              </div>
              <div x-show="configContent?.meta?.description">
                <div class="meta-text">Description</div>
                <div class="font-medium" x-text="configContent?.meta?.description"></div>
              </div>
              <div x-show="configContent?.generation?.tasks">
                <div class="meta-text">Generation Tasks</div>
                <div class="font-medium" x-text="configContent?.generation?.tasks?.length + ' tasks'"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Model Details -->
        <div class="card-sectioned">
          <div class="card-header">
            <h4 class="font-semibold">Model Configuration</h4>
          </div>
          <div class="card-body">
            <div class="grid-2 gap-m">
              <div>
                <div class="meta-text">Selected Model</div>
                <div class="font-medium" x-text="selectedModel?.name"></div>
              </div>
              <div>
                <div class="meta-text">Provider</div>
                <div class="font-medium" x-text="getProviderName(selectedModel)"></div>
              </div>
              <div>
                <div class="meta-text">Temperature</div>
                <div class="font-medium" x-text="parameters.temperature"></div>
              </div>
              <div>
                <div class="meta-text">Max Tokens</div>
                <div class="font-medium" x-text="parameters.maxTokens?.toLocaleString()"></div>
              </div>
              <div x-show="enableOnlineSearch">
                <div class="meta-text">Web Search</div>
                <div class="font-medium text-primary">Enabled üåê</div>
              </div>
              <div>
                <div class="meta-text">Total Items</div>
                <div class="font-medium" x-text="parameters.count"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Cost Estimation -->
        <div x-show="getEstimatedCost()" class="alert alert-warning">
          <div>
            <p class="font-medium mb-s">üí∞ Estimated Cost</p>
            <div class="grid gap-m mt-s" :class="enableOnlineSearch && selectedModel?.supports_web_search ? 'grid-4' : 'grid-3'">
              <div>
                <div class="text-xs">Input</div>
                <div class="font-medium">$<span x-text="getEstimatedCost()?.prompt"></span></div>
              </div>
              <div>
                <div class="text-xs">Output</div>
                <div class="font-medium">$<span x-text="getEstimatedCost()?.completion"></span></div>
              </div>
              <div x-show="enableOnlineSearch && selectedModel?.supports_web_search">
                <div class="text-xs">Web Search</div>
                <div class="font-medium">$<span x-text="getEstimatedCost()?.webSearch"></span></div>
              </div>
              <div>
                <div class="text-xs">Total</div>
                <div class="font-bold text-lg">$<span x-text="getEstimatedCost()?.total"></span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions Info -->
        <div class="meta-text text-center">
          <p>Ready to generate <span x-text="parameters.count" class="font-medium"></span> items using <span x-text="selectedModel?.name" class="font-medium"></span></p>
          <p class="mt-s">Results will be saved to the outputs folder</p>
        </div>
      </div>
      
      <div class="flex justify-between mt-l">
        <button @click="prevStep()" class="btn btn-ghost">‚Üê Back</button>
        <button @click="startGeneration()" class="btn btn-primary">
          ‚ú® Start Generation
        </button>
      </div>
    </div>
  </div>
  
  <!-- Step 4: Generating -->
  <div x-show="step === 4" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Generating Data</h3>
      
      <div class="mb-m">
        <div class="flex justify-between text-sm mb-s">
          <span>Progress</span>
          <span><span x-text="progress.current"></span> / <span x-text="progress.total"></span> items</span>
        </div>
        <div class="progress">
          <div class="progress-bar" :style="`width: ${progress.percentage}%`"></div>
        </div>
      </div>
      
      <div x-show="progress.currentItem" class="meta-text">
        Currently generating: <span x-text="progress.currentItem" class="font-medium"></span>
      </div>
      
      <div x-show="!isGenerating && progress.percentage === 100" class="mt-4">
        <div class="alert alert-success">
          <p>Generation completed successfully!</p>
        </div>
        <a href="#/results" class="btn btn-primary mt-4">View Results ‚Üí</a>
      </div>
    </div>
  </div>
</div>