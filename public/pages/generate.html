<div class="stack">
  <div class="mb-m">
    <h2 class="text-2xl font-semibold">Data Generator</h2>
    <p class="text-gray-600 mt-s">Generate structured data using AI models</p>
  </div>
  <div class="action-row mb-l">
    <template x-for="(label, index) in ['Select Config', 'Select Model', 'Confirm']" :key="index">
      <div class="flex items-center">
        <div class="flex items-center">
          <div class="progress-indicator"
               :class="step > index + 1 ? 'progress-indicator-completed' : step === index + 1 ? 'progress-indicator-active' : 'progress-indicator-pending'"
               x-text="index + 1"></div>
          <span class="text-sm ml-s" 
                :class="step === index + 1 ? 'text-primary font-medium' : 'text-gray-500'"
                x-text="label"></span>
        </div>
        <div x-show="index < 2" class="progress-connector"
             :class="step > index + 1 ? 'progress-connector-completed' : ''"></div>
      </div>
    </template>
  </div>
  <div x-show="step === 1" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Select Configuration</h3>
      <div x-show="!hasConfigParam" class="empty-state">
        <p class="text-gray-600 mb-m">Please select a configuration from the File Manager to generate data.</p>
        <a href="#/files" class="btn btn-primary">Go to File Manager</a>
      </div>
      <div x-show="hasConfigParam" class="flex flex-col items-center justify-center py-l">
        <div class="spinner mb-m"></div>
        <p class="text-gray-600">Loading configuration...</p>
      </div>
    </div>
  </div>
  <div x-show="step === 2" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Select AI Model</h3>
      <div x-show="configModel" class="mb-m">
        <p class="meta-text mb-s">
          Configuration uses this model:
          <span x-show="configModel && configModel.endsWith(':online')" class="ml-1">üåê</span>
        </p>
        <template x-if="configModelObject">
          <div class="card p-m" :class="selectedModel?.id === configModelObject.id ? 'border-primary' : ''">
            <div class="flex justify-between">
              <div class="flex-1">
                <div class="flex justify-between items-start mb-s">
                  <h4 class="font-medium text-sm ">
                    <span x-text="configModelObject.name"></span>
                    <span x-show="configModel && configModel.endsWith(':online')" class="ml-1">üåê</span>
                  </h4>
                  <span class="text-xs text-gray-500 ml-s" x-text="getProviderName(configModelObject)"></span>
                </div>
                <div class="flex flex-wrap gap-s mb-s">
                  <template x-for="badge in getModelBadges(configModelObject)" :key="badge.label">
                    <span :class="badge.class" class="badge text-xs " x-text="badge.label"></span>
                  </template>
                </div>
                <div class="text-xs text-gray-600">
                  <div class="flex items-center gap-s flex-wrap">
                    <div x-show="configModelObject.max_completion_tokens" class="flex items-center gap-s">
                      <span class="text-gray-500">Max:</span>
                      <span x-text="configModelObject.max_completion_tokens?.toLocaleString() + ' tokens'"></span>
                    </div>
                    <div x-show="configModelObject.input_modalities?.length > 0 || configModelObject.output_modalities?.length > 0" class="text-gray-500">
                      <span x-text="formatModalities(configModelObject.input_modalities, configModelObject.output_modalities)"></span>
                    </div>
                  </div>
                  <div class="flex justify-between mt-s">
                    <template x-if="(configModelObject.pricing?.prompt || 0) < 0">
                      <span class="text-gray-500 col-span-2">Auto-routing (variable pricing)</span>
                    </template>
                    <template x-if="(configModelObject.pricing?.prompt || 0) >= 0">
                      <>
                        <span class="text-gray-500">$<span x-text="((configModelObject.pricing?.prompt || 0) * 1000).toFixed(3)"></span>/1K in</span>
                        <span class="text-gray-500">$<span x-text="((configModelObject.pricing?.completion || 0) * 1000).toFixed(3)"></span>/1K out</span>
                      </>
                    </template>
                  </div>
                  <div x-show="configModelObject.supports_web_search" class="mt-s">
                    <template x-if="getWebSearchPricing(configModelObject)">
                      <span class="text-xs text-primary">
                        <span x-text="getWebSearchPricing(configModelObject).label"></span>: 
                        $<span x-text="getWebSearchPricing(configModelObject).price.toFixed(2)"></span>/1K requests
                      </span>
                    </template>
                  </div>
                </div>
              </div>
              <div class="ml-m flex flex-col gap-s">
                <button x-show="!selectedModel || selectedModel.id !== configModelObject.id" 
                        @click="selectedModel = configModelObject; enableOnlineSearch = configModel.endsWith(':online'); if(selectedModel) nextStep()" 
                        class="btn btn-primary btn-sm">
                  Use this model
                </button>
                <button x-show="selectedModel && selectedModel.id === configModelObject.id" 
                        @click="nextStep()" 
                        class="btn btn-primary btn-sm">
                  Continue ‚Üí
                </button>
              </div>
            </div>
          </div>
        </template>
        <div class="mt-m meta-text">Or select a different model below:</div>
      </div>
      <div class="model-selector">
        <div class="mb-4">
          <div class="search-box mb-3">
            <input 
              type="text" 
              class="form-input" 
              placeholder="Search models..."
              x-model="modelSearch"
            >
          </div>
          <div class="mb-3">
            <div class="text-sm text-gray-600 mb-2">Quick Filters:</div>
            <div class="flex flex-wrap gap-2">
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'all' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('all')"
              >
                üåê All Models
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'free' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('free')"
              >
                üÜì Free
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'cheap' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('cheap')"
              >
                üí∞ Cheap (<$0.001)
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'fast' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('fast')"
              >
                ‚ö° Fast
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'smart' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('smart')"
              >
                üß† Smart (GPT-4/Claude)
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'multimodal' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('multimodal')"
              >
                üñºÔ∏è Multimodal
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'large-context' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('large-context')"
              >
                üìö 100K+ Context
              </button>
              <button 
                class="btn btn-sm"
                :class="modelFilter === 'coding' ? 'btn-primary' : 'btn-secondary'"
                @click="setModelFilter('coding')"
              >
                üíª Coding
              </button>
            </div>
          </div>
          <div class="mb-3">
            <div class="mt-3 space-y-3">
              <div>
                <div class="text-sm text-gray-600 mb-2">Provider:</div>
                <div class="flex flex-wrap gap-2">
                  <button @click="toggleFilter('provider', 'openai')"
                          :class="isFilterActive('provider', 'openai') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    OpenAI
                  </button>
                  <button @click="toggleFilter('provider', 'anthropic')"
                          :class="isFilterActive('provider', 'anthropic') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    Anthropic
                  </button>
                  <button @click="toggleFilter('provider', 'google')"
                          :class="isFilterActive('provider', 'google') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    Google
                  </button>
                  <button @click="toggleFilter('provider', 'meta')"
                          :class="isFilterActive('provider', 'meta') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    Meta
                  </button>
                  <button @click="toggleFilter('provider', 'mistral')"
                          :class="isFilterActive('provider', 'mistral') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    Mistral
                  </button>
                  <button @click="toggleFilter('provider', 'perplexity')"
                          :class="isFilterActive('provider', 'perplexity') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    Perplexity
                  </button>
                </div>
              </div>
              <div>
                <div class="text-sm text-gray-600 mb-2">Capabilities:</div>
                <div class="flex flex-wrap gap-2">
                  <button @click="toggleFilter('capabilities', 'function-calling')"
                          :class="isFilterActive('capabilities', 'function-calling') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    üîß Function Calling
                  </button>
                  <button @click="toggleFilter('capabilities', 'json-mode')"
                          :class="isFilterActive('capabilities', 'json-mode') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    üìã JSON Mode
                  </button>
                  <button @click="toggleFilter('capabilities', 'web-search')"
                          :class="isFilterActive('capabilities', 'web-search') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    üîç Web Search
                  </button>
                  <button @click="toggleFilter('capabilities', 'vision')"
                          :class="isFilterActive('capabilities', 'vision') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    üëÅÔ∏è Vision
                  </button>
                </div>
              </div>
              <div>
                <div class="text-sm text-gray-600 mb-2">Context Size:</div>
                <div class="flex flex-wrap gap-2">
                  <button @click="toggleFilter('context', '4k')"
                          :class="isFilterActive('context', '4k') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    4K
                  </button>
                  <button @click="toggleFilter('context', '8k')"
                          :class="isFilterActive('context', '8k') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    8K
                  </button>
                  <button @click="toggleFilter('context', '16k')"
                          :class="isFilterActive('context', '16k') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    16K
                  </button>
                  <button @click="toggleFilter('context', '32k')"
                          :class="isFilterActive('context', '32k') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    32K
                  </button>
                  <button @click="toggleFilter('context', '128k+')"
                          :class="isFilterActive('context', '128k+') ? 'btn btn-primary btn-sm' : 'btn btn-ghost btn-sm'"
                          class="text-xs">
                    128K+
                  </button>
                </div>
              </div>
              <div x-show="hasActiveFilters()" class="pt-2">
                <button @click="clearAllFilters()" class="btn btn-ghost btn-sm">
                  ‚ùå Clear All Filters
                </button>
              </div>
            </div>
          </div>
          <div class="mt-4">
            <button @click="nextStep()" :disabled="!selectedModel" class="btn btn-primary w-full">
              Apply Model ‚Üí
            </button>
          </div>
        </div>
        <div class="text-center py-8" x-show="isLoading">
          <div class="spinner"></div>
          <p class="text-muted mt-2">Loading models...</p>
        </div>
        <div class="models-grid" x-show="!isLoading">
          <template x-for="model in filteredModels" :key="model.id">
            <div 
              class="card-interactive"
              :class="selectedModel?.id === model.id ? 'selected' : ''"
              @click="selectModel(model)"
            >
              <div class="model-header">
                <h4 class="model-name" x-text="model.name"></h4>
                <span class="model-provider text-muted" x-text="getProviderName(model)"></span>
              </div>
              <div class="model-info">
                <div class="info-row">
                  <span class="label">Context:</span>
                  <span class="value" x-text="formatContext(model.context_length)"></span>
                </div>
                <div class="info-row">
                  <span class="label">Price:</span>
                  <span class="value" x-text="formatPrice(model.pricing)"></span>
                </div>
              </div>
              <div class="model-tags">
                <span class="tag tag-blue" x-show="!model.pricing || (model.pricing.prompt === 0 && model.pricing.completion === 0)">
                  Free
                </span>
                <span class="tag tag-green" x-show="model.input_modalities?.includes('image') || model.input_modalities?.includes('audio')">
                  Multimodal
                </span>
                <span class="tag tag-purple" x-show="model.context_length >= 100000">
                  Large Context
                </span>
              </div>
            </div>
          </template>
        </div>
        <div class="text-center py-8" x-show="!isLoading && filteredModels.length === 0">
          <p class="text-muted">No models found matching your criteria</p>
        </div>
        
      </div>
      
      <div class="flex justify-between mt-l">
        <button @click="prevStep()" class="btn btn-ghost">‚Üê Back</button>
      </div>
    </div>
  </div>
  <div x-show="step === 3" class="card">
    <div class="card-body">
      <h3 class="text-lg font-semibold mb-m">Confirm Generation</h3>
      
      <div class="stack-m">
        <div class="card-sectioned">
          <div class="card-header">
            <h4 class="font-semibold">Configuration Details</h4>
          </div>
          <div class="card-body">
            <div class="grid-2 gap-m">
              <div>
                <div class="meta-text">Configuration File</div>
                <div class="font-medium" x-text="selectedConfig?.name"></div>
              </div>
              <div>
                <div class="meta-text">Output Format</div>
                <div class="font-medium" x-text="configContent?.output?.format || 'json'"></div>
              </div>
              <div x-show="configContent?.meta?.description">
                <div class="meta-text">Description</div>
                <div class="font-medium" x-text="configContent?.meta?.description"></div>
              </div>
              <div x-show="configContent?.generation?.tasks">
                <div class="meta-text">Generation Tasks</div>
                <div class="font-medium" x-text="configContent?.generation?.tasks?.length + ' tasks'"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-sectioned">
          <div class="card-header">
            <h4 class="font-semibold">Model Configuration</h4>
          </div>
          <div class="card-body">
            <div class="grid-2 gap-m">
              <div>
                <div class="meta-text">Selected Model</div>
                <div class="font-medium" x-text="selectedModel?.name"></div>
              </div>
              <div>
                <div class="meta-text">Provider</div>
                <div class="font-medium" x-text="getProviderName(selectedModel)"></div>
              </div>
              <div>
                <div class="meta-text">Temperature</div>
                <div class="font-medium" x-text="parameters.temperature"></div>
              </div>
              <div>
                <div class="meta-text">Max Tokens</div>
                <div class="font-medium" x-text="parameters.maxTokens?.toLocaleString()"></div>
              </div>
              <div x-show="enableOnlineSearch">
                <div class="meta-text">Web Search</div>
                <div class="font-medium text-primary">Enabled üåê</div>
              </div>
              <div>
                <div class="meta-text">Total Items</div>
                <div class="font-medium" x-text="parameters.count"></div>
              </div>
            </div>
          </div>
        </div>
        <div x-show="getEstimatedCost()" class="alert alert-warning">
          <div>
            <p class="font-medium mb-s">üí∞ Estimated Cost</p>
            <div class="grid gap-m mt-s" :class="enableOnlineSearch && selectedModel?.supports_web_search ? 'grid-4' : 'grid-3'">
              <div>
                <div class="text-xs">Input</div>
                <div class="font-medium">$<span x-text="getEstimatedCost()?.prompt"></span></div>
              </div>
              <div>
                <div class="text-xs">Output</div>
                <div class="font-medium">$<span x-text="getEstimatedCost()?.completion"></span></div>
              </div>
              <div x-show="enableOnlineSearch && selectedModel?.supports_web_search">
                <div class="text-xs">Web Search</div>
                <div class="font-medium">$<span x-text="getEstimatedCost()?.webSearch"></span></div>
              </div>
              <div>
                <div class="text-xs">Total</div>
                <div class="font-bold text-lg">$<span x-text="getEstimatedCost()?.total"></span></div>
              </div>
            </div>
          </div>
        </div>
        <div class="meta-text text-center">
          <p>Ready to generate <span x-text="parameters.count" class="font-medium"></span> items using <span x-text="selectedModel?.name" class="font-medium"></span></p>
          <p class="mt-s">Results will be saved to the outputs folder</p>
        </div>
      </div>
      
      <div class="flex justify-between mt-l">
        <button @click="prevStep()" class="btn btn-ghost">‚Üê Back</button>
        <button @click="startGeneration()" class="btn btn-primary">
          ‚ú® Start Generation
        </button>
      </div>
    </div>
  </div>
  
</div>