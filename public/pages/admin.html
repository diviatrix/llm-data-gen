<div class="stack">
  
  <div class="mb-m">
    <h2 class="text-2xl font-semibold" x-text="$store.i18n.t('admin.settings')"></h2>
    <p class="meta-text mt-s" x-text="$store.i18n.t('admin.manageSettings')"></p>
  </div>

  <div class="card mb-l">
    <div class="card-body">
      <div class="mb-m">
        <label class="label" x-text="$store.i18n.t('admin.siteTitle')"></label>
        <div class="flex gap-s">
          <input type="text" 
                 class="form-input flex-1" 
                 x-model="newSiteTitle"
                 @keyup.enter="updateSiteTitle()">
          <button @click="updateSiteTitle()" 
                  class="btn btn-primary">
            <span x-text="$store.i18n.t('buttons.save')"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-m">
    <h2 class="text-2xl font-semibold" x-text="$store.i18n.t('admin.userManagement')"></h2>
    <p class="meta-text mt-s" x-text="$store.i18n.t('admin.manageUsers')"></p>
  </div>

  
  <div class="grid-3 mb-l">
    <div class="card">
      <div class="card-body">
        <div class="text-2xl font-bold" x-text="stats.total || 0"></div>
        <div class="meta-text" x-text="$store.i18n.t('admin.totalUsers')"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="text-2xl font-bold text-success" x-text="stats.active || 0"></div>
        <div class="meta-text" x-text="$store.i18n.t('admin.activeUsers')"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <div class="text-2xl font-bold text-error" x-text="stats.inactive || 0"></div>
        <div class="meta-text" x-text="$store.i18n.t('admin.inactiveUsers')"></div>
      </div>
    </div>
  </div>

  
  <div class="action-row mb-m">
    <h3 class="text-lg font-semibold" x-text="$store.i18n.t('admin.users')"></h3>
    <button @click="showCreateModal = true" class="btn btn-primary btn-sm">
      + <span x-text="$store.i18n.t('buttons.addUser')"></span>
    </button>
  </div>

  
  <div x-show="isLoading" class="flex justify-center py-l">
    <div class="spinner"></div>
  </div>

  
  <div x-show="!isLoading" class="overflow-auto">
    <table class="w-full bg-white rounded-lg shadow-sm border border-gray-200">
        <thead>
          <tr class="border-b">
            <th class="text-left p-m" x-text="$store.i18n.t('admin.id')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.email')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.role')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.apiKey')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.storage')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.status')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.created')"></th>
            <th class="text-left p-m" x-text="$store.i18n.t('admin.actions')"></th>
          </tr>
        </thead>
        <tbody>
          <template x-for="user in users" :key="user.id">
            <tr class="border-b">
              <td class="p-m font-mono text-sm" x-text="user.id"></td>
              <td class="p-m" x-text="user.email"></td>
              <td class="p-m">
                <span class="badge badge-primary" x-text="user.role_name || 'user'"></span>
              </td>
              <td class="p-m">
                <span :class="user.has_api_key ? 'text-success' : 'text-gray-400'" 
                      x-text="user.has_api_key ? '‚úì ' + $store.i18n.t('admin.set') : '‚úó ' + $store.i18n.t('admin.notSet')"></span>
              </td>
              <td class="p-m">
                <div class="text-xs">
                  <span x-text="formatBytes(user.storage_used || 0)"></span> / 
                  <span x-text="formatBytes(user.storage_quota || 10485760)"></span>
                </div>
              </td>
              <td class="p-m">
                <span class="badge" :class="user.is_active ? 'badge-success' : 'badge-secondary'"
                      x-text="user.is_active ? $store.i18n.t('admin.active') : $store.i18n.t('admin.inactive')"></span>
              </td>
              <td class="p-m meta-text" x-text="formatDate(user.created_at)"></td>
              <td class="p-m">
                <div class="flex gap-s">
                  <button @click="editUserDetails(user)" class="btn btn-ghost btn-sm">
                    ‚úèÔ∏è <span x-text="$store.i18n.t('buttons.edit')"></span>
                  </button>
                  <button @click="showChangeRole(user)" class="btn btn-ghost btn-sm">
                    üë§ <span x-text="$store.i18n.t('admin.role')"></span>
                  </button>
                  <button @click="toggleUserStatus(user)" 
                          class="btn btn-ghost btn-sm"
                          :class="user.is_active ? 'text-warning' : 'text-success'">
                    <span x-text="user.is_active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'"></span>
                  </button>
                  <button @click="resetPassword(user)" class="btn btn-ghost btn-sm">
                    üîë
                  </button>
                  <button @click="deleteUser(user)" class="btn btn-danger btn-sm">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </template>
        </tbody>
    </table>

    
    <div x-show="users.length === 0" class="empty-state">
      <p x-text="$store.i18n.t('admin.noUsersFound')"></p>
    </div>
  </div>

  
  <div x-show="showCreateModal" class="modal-backdrop" @click.self="showCreateModal = false">
    <div class="modal">
      <div class="modal-header">
        <h3 class="text-lg font-semibold" x-text="$store.i18n.t('admin.createNewUser')"></h3>
        <button @click="showCreateModal = false" class="btn btn-ghost btn-sm">‚úï</button>
      </div>
      <form @submit.prevent="createUser">
        <div class="modal-body stack">
          <div>
            <label x-text="$store.i18n.t('forms.email')"></label>
            <input type="email" x-model="newUser.email" required>
          </div>
          <div>
            <label x-text="$store.i18n.t('forms.password')"></label>
            <input type="password" x-model="newUser.password" required minlength="8">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" @click="showCreateModal = false" class="btn btn-secondary">
            <span x-text="$store.i18n.t('buttons.cancel')"></span>
          </button>
          <button type="submit" class="btn btn-primary">
            <span x-text="$store.i18n.t('buttons.createUser')"></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  
  <div x-show="showResetModal" class="modal-backdrop" @click.self="showResetModal = false">
    <div class="modal">
      <div class="modal-header">
        <h3 class="text-lg font-semibold" x-text="$store.i18n.t('admin.resetPassword')"></h3>
        <button @click="showResetModal = false" class="btn btn-ghost btn-sm">‚úï</button>
      </div>
      <form @submit.prevent="confirmResetPassword">
        <div class="modal-body stack">
          <p><span x-text="$store.i18n.t('admin.resetPasswordFor', {email: selectedUser?.email})"></span></p>
          <div>
            <label x-text="$store.i18n.t('forms.newPassword')"></label>
            <input type="password" x-model="resetPasswordData.newPassword" required minlength="8">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" @click="showResetModal = false" class="btn btn-secondary">
            <span x-text="$store.i18n.t('buttons.cancel')"></span>
          </button>
          <button type="submit" class="btn btn-primary">
            <span x-text="$store.i18n.t('buttons.resetPassword')"></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  
  <div x-show="showEditModal" class="modal-backdrop" @click.self="showEditModal = false">
    <div class="modal">
      <div class="modal-header">
        <h3 class="text-lg font-semibold" x-text="$store.i18n.t('admin.editUserDetails')"></h3>
        <button @click="showEditModal = false" class="btn btn-ghost btn-sm">‚úï</button>
      </div>
      <form @submit.prevent="updateUserDetails">
        <div class="modal-body stack">
          <div>
            <label x-text="$store.i18n.t('forms.user')"></label>
            <input type="text" :value="selectedUser?.email" readonly class="form-input bg-gray-100">
          </div>
          <div>
            <label x-text="$store.i18n.t('forms.storageQuota')"></label>
            <input type="number" x-model="editUserData.quotaMB" min="1" max="10000" required class="form-input">
            <p class="text-xs text-gray-600 mt-s">
              <span x-text="$store.i18n.t('admin.currentlyUsing')"></span>: <span x-text="formatBytes(selectedUser?.storage_used || 0)"></span>
            </p>
          </div>
          <div>
            <label x-text="$store.i18n.t('forms.apiKey')"></label>
            <input type="text" x-model="editUserData.apiKey" placeholder="sk-or-v1-..." class="form-input">
            <p class="text-xs text-gray-600 mt-s">
              <span x-text="$store.i18n.t('admin.leaveEmptyToKeep')"></span>
            </p>
          </div>
          <div>
            <label class="flex items-center gap-s cursor-pointer">
              <input type="checkbox" x-model="editUserData.onlyFreeModels" class="form-checkbox">
              <span x-text="$store.i18n.t('admin.onlyFreeModels')"></span>
            </label>
            <p class="text-xs text-gray-600 mt-s">
              <span x-text="$store.i18n.t('admin.onlyFreeModelsDesc')"></span>
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" @click="showEditModal = false" class="btn btn-secondary">
            <span x-text="$store.i18n.t('buttons.cancel')"></span>
          </button>
          <button type="submit" class="btn btn-primary">
            <span x-text="$store.i18n.t('admin.updateDetails')"></span>
          </button>
        </div>
      </form>
    </div>
  </div>
  
  
  <div x-show="showRoleModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 class="text-lg font-semibold" x-text="$store.i18n.t('admin.changeUserRole')"></h3>
        <button @click="showRoleModal = false" class="btn btn-ghost btn-sm">‚úï</button>
      </div>
      <form @submit.prevent="changeUserRole">
        <div class="modal-body stack">
          <div>
            <label x-text="$store.i18n.t('forms.user')"></label>
            <input type="text" :value="selectedUser?.email" readonly class="form-input bg-gray-100">
          </div>
          <div>
            <label x-text="$store.i18n.t('forms.role')"></label>
            <select x-model="roleChangeData.roleId" class="form-input" required>
              <template x-for="role in roles" :key="role.id">
                <option :value="role.id" x-text="role.name"></option>
              </template>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" @click="showRoleModal = false" class="btn btn-secondary">
            <span x-text="$store.i18n.t('buttons.cancel')"></span>
          </button>
          <button type="submit" class="btn btn-primary">
            <span x-text="$store.i18n.t('buttons.updateRole')"></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>