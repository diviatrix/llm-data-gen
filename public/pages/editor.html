<div class="stack">
  
  <div x-show="!filePath" class="card">
    <div class="card-body empty-state">
      <div class="text-3xl mb-m">‚úèÔ∏è</div>
      <h3 class="text-xl font-medium mb-s" x-text="$store.i18n.t('editor.noFileSelected')"></h3>
      <p class="text-gray-600 mb-m" x-text="$store.i18n.t('editor.selectFileToEdit')"></p>
      <a href="#/files" class="btn btn-primary" x-text="$store.i18n.t('editor.goToFileManager')"></a>
    </div>
  </div>

  
  <div x-show="filePath">
    
    <div class="flex justify-between items-center mb-m">
      <div>
        <h2 class="text-2xl font-bold" x-text="$store.i18n.t('editor.dataEditor')"></h2>
        <p class="text-gray-600 mt-s" x-show="fileName">
          <span x-text="$store.i18n.t('editor.editing')"></span>: <span x-text="fileName" class="font-medium"></span>
        </p>
      </div>
      <div class="flex gap-s">
        <button @click="goBack()" class="btn btn-ghost">
          ‚Üê <span x-text="$store.i18n.t('buttons.cancel')"></span>
        </button>
        <button @click="saveFile()" class="btn btn-primary" :disabled="!hasChanges">
          üíæ <span x-text="$store.i18n.t('buttons.save')"></span>
        </button>
      </div>
    </div>
    
    
    <div x-show="isLoading" class="flex justify-center items-center py-l">
      <div class="spinner"></div>
    </div>
    
    
    <div x-show="error" class="alert alert-error">
      <p x-text="error"></p>
    </div>
  
  
  <div x-show="!isLoading && !error && content !== null && filePath" class="card">
    <div class="card-body">
      
      <div x-show="fileType === 'json'">
        
        <div class="flex justify-between items-center mb-m">
          <div class="flex gap-s">
            <button @click="formatJson()" class="btn btn-secondary btn-sm">
              üìê <span x-text="$store.i18n.t('editor.format')"></span>
            </button>
            <button @click="validateJson()" class="btn btn-secondary btn-sm">
              ‚úì <span x-text="$store.i18n.t('editor.validate')"></span>
            </button>
            <button @click="switchToVisualEditor()" class="btn btn-secondary btn-sm" x-show="!visualMode">
              üé® <span x-text="$store.i18n.t('editor.visualEditor')"></span>
            </button>
            <button @click="switchToCodeEditor()" class="btn btn-secondary btn-sm" x-show="visualMode">
              üìù <span x-text="$store.i18n.t('editor.codeEditor')"></span>
            </button>
          </div>
          <div x-show="jsonError" class="text-sm text-error">
            <span x-text="jsonError"></span>
          </div>
        </div>
        
        
        <div x-show="!visualMode">
          <textarea 
            x-model="editableContent"
            @input="hasChanges = true; validateJson()"
            class="form-input font-mono text-sm"
            rows="20"
          ></textarea>
        </div>
        
        
        <template x-if="visualMode && parsedJson">
        <div class="space-y-4">
          <div class="alert alert-info text-sm">
            <span x-text="$store.i18n.t('editor.visualEditorDescription')"></span>
          </div>
          
          
          <div x-show="parsedJson && parsedJson.meta" class="card">
            <div class="card-header">
              <h4 class="text-medium" x-text="$store.i18n.t('editor.metaInformation')"></h4>
            </div>
            <div class="card-body space-y-3">
              <template x-if="parsedJson && parsedJson.meta">
              <div class="space-y-3">
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.name')"></label>
                  <input type="text" x-model="parsedJson.meta.name" @input="updateFromVisual()" class="form-input">
                </div>
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.description')"></label>
                  <textarea x-model="parsedJson.meta.description" @input="updateFromVisual()" class="form-input" rows="2"></textarea>
                </div>
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.version')"></label>
                  <input type="text" x-model="parsedJson.meta.version" @input="updateFromVisual()" class="form-input">
                </div>
              </div>
              </template>
            </div>
          </div>
          
          
          <div x-show="parsedJson && parsedJson.api" class="card">
            <div class="card-header">
              <h4 class="text-medium" x-text="$store.i18n.t('editor.apiSettings')"></h4>
            </div>
            <div class="card-body grid-2 gap-3">
              <template x-if="parsedJson && parsedJson.api">
              <div class="contents">
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.model')"></label>
                  <input type="text" x-model="parsedJson.api.model" @input="updateFromVisual()" class="form-input">
                </div>
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.temperature')"></label>
                  <input type="number" x-model.number="parsedJson.api.temperature" @input="updateFromVisual()" 
                         class="form-input" min="0" max="2" step="0.1">
                </div>
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.maxTokens')"></label>
                  <input type="number" x-model.number="parsedJson.api.maxTokens" @input="updateFromVisual()" 
                         class="form-input" min="1">
                </div>
                <div>
                  <label class="form-label" x-text="$store.i18n.t('forms.batchDelay')"></label>
                  <input type="number" x-model.number="parsedJson.api.batchDelay" @input="updateFromVisual()" 
                         class="form-input" min="0">
                </div>
              </div>
              </template>
            </div>
          </div>
          
          
          <div x-show="parsedJson && parsedJson.generation && parsedJson.generation.tasks" class="card">
            <div class="card-header flex-between">
              <h4 class="text-medium" x-text="$store.i18n.t('editor.generationTasks')"></h4>
              <button @click="addTask()" class="btn btn-secondary btn-sm">+ <span x-text="$store.i18n.t('buttons.addTask')"></span></button>
            </div>
            <div class="card-body space-y-3">
              <template x-if="parsedJson && parsedJson.generation && parsedJson.generation.tasks">
              <template x-for="(task, index) in parsedJson.generation.tasks" :key="index">
                <div class="flex gap-3 items-end">
                  <div class="flex-1">
                    <label class="form-label" x-text="$store.i18n.t('forms.theme')"></label>
                    <input type="text" x-model="task.theme" @input="updateFromVisual()" class="form-input">
                  </div>
                  <div class="w-32">
                    <label class="form-label" x-text="$store.i18n.t('forms.count')"></label>
                    <input type="number" x-model.number="task.count" @input="updateFromVisual()" 
                           class="form-input" min="1">
                  </div>
                  <button @click="removeTask(index)" class="btn btn-ghost btn-sm text-danger mb-1">üóëÔ∏è</button>
                </div>
              </template>
              </template>
            </div>
          </div>
          
          
          <div class="card">
            <div class="card-header">
              <h4 class="text-medium" x-text="$store.i18n.t('editor.rawJson')"></h4>
            </div>
            <div class="card-body">
              <pre class="code-block text-xs overflow-auto max-h-64" x-text="JSON.stringify(parsedJson, null, 2)"></pre>
            </div>
          </div>
        </div>
        </template>
      </div>
      
      
      <div x-show="fileType === 'text'">
        <textarea 
          x-model="editableContent"
          @input="hasChanges = true"
          class="form-input font-mono text-sm"
          rows="20"
        ></textarea>
      </div>
      
      
      <div x-show="fileType === 'markdown'">
        <div class="grid-2 gap-4">
          
          <div>
            <h4 class="text-medium mb-2" x-text="$store.i18n.t('editor.editor')"></h4>
            <textarea 
              x-model="editableContent"
              @input="hasChanges = true"
              class="form-input font-mono text-sm"
              rows="20"
              ></textarea>
          </div>
          
          
          <div>
            <h4 class="text-medium mb-2" x-text="$store.i18n.t('editor.preview')"></h4>
            <div class="card">
              <div class="card-body prose prose-sm max-w-none" x-html="renderMarkdownContent(editableContent)"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</div>