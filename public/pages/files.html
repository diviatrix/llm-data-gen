<div class="stack">
  
  <div class="mb-m">
    <h2 class="text-2xl font-semibold" x-text="$store.i18n.t('files.fileManager')"></h2>
    <p class="text-gray-600 mt-s" x-text="$store.i18n.t('files.manageFiles')"></p>
  </div>
  
  <!-- Storage Quota Display -->
  <div x-show="storageInfo" class="card mb-m">
    <div class="card-body p-s">
      <div class="flex justify-between items-center mb-s">
        <span class="text-sm font-medium">–•—Ä–∞–Ω–∏–ª–∏—â–µ</span>
        <span class="text-xs text-gray-600">
          <span x-text="formatFileSize(storageInfo?.used || 0)"></span> / 
          <span x-text="formatFileSize(storageInfo?.quota || 0)"></span>
        </span>
      </div>
      <div class="progress">
        <div class="progress-bar" :style="`width: ${storagePercentage}%`"></div>
      </div>
    </div>
  </div>
  
  
  
  <nav x-show="currentPath" class="mb-m">
    <ol class="flex items-center gap-s text-sm">
      <template x-for="(crumb, index) in getBreadcrumbs()" :key="crumb.path">
        <li class="flex items-center">
          <button @click="navigateToBreadcrumb(crumb.path)" 
                  class="text-primary hover:underline"
                  :class="index === getBreadcrumbs().length - 1 ? 'font-medium' : ''"
                  x-text="crumb.name"></button>
          <span x-show="index < getBreadcrumbs().length - 1" class="mx-s text-gray-400">/</span>
        </li>
      </template>
    </ol>
  </nav>
  
  
  <div class="flex justify-between items-center mb-m">
    <div class="meta-text">
      <span x-text="currentFiles.length"></span> <span x-text="$store.i18n.t('files.files')"></span>
    </div>
    <div class="flex gap-s">
      <button x-show="currentPath" 
              @click="navigateUp()" 
              @dragover.prevent="$event.currentTarget.classList.add('drag-over')"
              @dragleave.prevent="$event.currentTarget.classList.remove('drag-over')"
              @drop.prevent="handleDropOnUpButton($event)"
              class="btn btn-ghost btn-sm px-m">
        ‚Üë <span x-text="$store.i18n.t('buttons.up') || '–í–≤–µ—Ä—Ö'"></span>
      </button>
      <button @click="showCreateFolderModal()" 
              class="btn btn-ghost btn-sm">
        üìÅ+ –ü–∞–ø–∫–∞
      </button>
      <button @click="selectAndUploadFiles()" 
              class="btn btn-ghost btn-sm">
        üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å
      </button>
      <button @click="createNewConfig()" 
              class="btn btn-primary btn-sm">
        + <span x-text="$store.i18n.t('buttons.newConfiguration')"></span>
      </button>
    </div>
  </div>
  
  
  <div x-show="isLoading" class="flex justify-center items-center py-l">
    <div class="spinner"></div>
  </div>
  
  
  <div x-show="!isLoading && currentFiles.length > 0" class="grid-2">
    <template x-for="file in currentFiles" :key="file.name">
      <div class="card-interactive" 
           :class="file.isDirectory ? 'cursor-pointer' : ''"
           :data-filename="file.name"
           :draggable="!file.isDirectory"
           @dragstart="handleDragStart($event, file)"
           @dragend="handleDragEnd($event)"
           @dragover.prevent="file.isDirectory && $event.currentTarget.classList.add('drag-over')"
           @dragleave.prevent="file.isDirectory && $event.currentTarget.classList.remove('drag-over')"
           @drop.prevent="file.isDirectory && handleDropOnFolder($event, file)"
           @click="file.isDirectory && navigateToFolder(file)">
        <div class="card-body">
          <div class="flex items-center gap-s">
            <div class="text-xl flex-shrink-0" x-text="getFileIcon(file)"></div>
            <div class="flex-1 min-w-0">
              <h4 class="font-medium text-sm break-words" x-text="file.name"></h4>
              <div class="text-xs text-gray-600">
                <span x-show="!file.isDirectory">
                  <span x-text="formatFileSize(file.size)"></span>
                  <span class="mx-s">‚Ä¢</span>
                </span>
                <span x-text="formatDate(file.modified)"></span>
              </div>
            </div>
            <div class="flex gap-s flex-shrink-0">
              
              <div class="flex gap-s">
                <template x-if="file.isDirectory">
                  <div class="flex gap-s">
                    <button @click.stop="navigateToFolder(file)" 
                            class="btn btn-ghost btn-sm" 
                            :title="$store.i18n.t('files.openFolder')">
                      üìÇ
                    </button>
                    <button @click.stop="deleteFolder(file)" 
                            class="btn btn-danger btn-sm" 
                            title="–£–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É">
                      üóëÔ∏è
                    </button>
                  </div>
                </template>
                <template x-if="!file.isDirectory">
                  <div class="flex gap-s">
                    <button @click.stop="viewFile(file)" 
                            class="btn btn-ghost btn-sm" 
                            :title="$store.i18n.t('files.view')">
                      üëÅÔ∏è
                    </button>
                    <button @click.stop="editFile(file)" 
                            class="btn btn-ghost btn-sm" 
                            :title="$store.i18n.t('files.edit')">
                      ‚úèÔ∏è
                    </button>
                    <button x-show="canGenerateFromFile(file)"
                            @click.stop="generateFromConfig(file)" 
                            class="btn btn-primary btn-sm" 
                            :title="$store.i18n.t('files.generate')">
                      üöÄ
                    </button>
                    <button @click.stop="downloadFile(file)" 
                            class="btn btn-ghost btn-sm" 
                            :title="$store.i18n.t('files.download')">
                      ‚¨áÔ∏è
                    </button>
                    <button @click.stop="deleteFile(file)" 
                            class="btn btn-danger btn-sm" 
                            :title="$store.i18n.t('files.delete')">
                      üóëÔ∏è
                    </button>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
  
  
  <div x-show="!isLoading && currentFiles.length === 0" class="card">
    <div class="card-body empty-state">
      <div class="text-3xl mb-m">
        <span>üìÅ</span>
      </div>
      <h3 class="text-xl font-medium mb-s" x-text="$store.i18n.t('files.noFilesFound') || '–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'"></h3>
      <p class="text-gray-600 mb-m">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</p>
      <button @click="createNewConfig()" 
              class="btn btn-primary">
        <span x-text="$store.i18n.t('buttons.createConfiguration')"></span>
      </button>
    </div>
  </div>
  
  <!-- Drag and Drop Zone -->
  <div x-show="!isLoading && currentFiles.length === 0" 
       @dragover.prevent
       @drop.prevent="handleDrop($event)"
       class="drop-zone mb-m">
    <div class="text-3xl mb-s">üì§</div>
    <p class="text-gray-600 mb-s">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏</p>
    <button @click="selectAndUploadFiles()" class="btn btn-primary">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</button>
  </div>
  
  <!-- Create Folder Modal -->
  <div x-show="showFolderModal" 
       @click.away="showFolderModal = false"
       x-transition
       class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-m" @click.stop>
      <h3 class="text-lg font-semibold mb-m">–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</h3>
      <input type="text" 
             x-model="newFolderName" 
             @keyup.enter="createFolder()"
             placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏"
             class="form-input mb-m"
             :disabled="isCreatingFolder">
      <div class="flex justify-end gap-s">
        <button @click="showFolderModal = false" 
                class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
        <button @click="createFolder()" 
                :disabled="!newFolderName || isCreatingFolder"
                class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- Upload Progress Modal -->
  <div x-show="isUploading" 
       x-transition
       class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-m">
      <h3 class="text-lg font-semibold mb-m">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
      <div class="mb-s">
        <p class="text-sm text-gray-600 mb-s" x-text="uploadingFileName"></p>
        <div class="progress">
          <div class="progress-bar" :style="`width: ${uploadProgress}%`"></div>
        </div>
      </div>
      <div class="text-center">
        <span class="text-sm text-gray-600" x-text="`${uploadProgress}%`"></span>
      </div>
    </div>
  </div>
  
  <!-- Create Config Modal -->
  <div x-show="showConfigModal" 
       @click.away="showConfigModal = false"
       x-transition
       class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-m" @click.stop>
      <h3 class="text-lg font-semibold mb-m">–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</h3>
      <input type="text" 
             x-model="newConfigName" 
             @keyup.enter="createConfigFile()"
             placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: my-config.json)"
             class="form-input mb-m"
             :disabled="isCreatingConfig">
      <div class="flex justify-end gap-s">
        <button @click="showConfigModal = false" 
                class="btn btn-ghost">–û—Ç–º–µ–Ω–∞</button>
        <button @click="createConfigFile()" 
                :disabled="!newConfigName || isCreatingConfig"
                class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </div>
  </div>
</div>